//@version=4
define("ORB")

// Webull-compatible ORB inputs
orbMinutes = input(15, title="ORB Length (minutes)", minval=1, maxval=120)
sessionStartHour = input(9, title="Session Start Hour", minval=0, maxval=23)
sessionStartMinute = input(30, title="Session Start Minute", minval=0, maxval=59)
showOnlyIntraday = input(true, title="Show on Intraday Charts Only", type=input.bool)

// Basic time/session state
isIntraday = timeframe.isintraday
shouldShow = showOnlyIntraday ? isIntraday : true
currentMinuteOfDay = hour * 60 + minute
sessionStart = sessionStartHour * 60 + sessionStartMinute
sessionEnd = sessionStart + orbMinutes
inOrbWindow = currentMinuteOfDay >= sessionStart and currentMinuteOfDay < sessionEnd

// Detect day rollover
isNewDay = year != year[1] or month != month[1] or dayofmonth != dayofmonth[1]

// ORB state
float orbHigh = na
float orbLow = na

if isNewDay
    orbHigh := na
    orbLow := na

if inOrbWindow
    orbHigh := na(orbHigh) ? high : max(orbHigh, high)
    orbLow := na(orbLow) ? low : min(orbLow, low)
else
    orbHigh := nz(orbHigh[1], orbHigh)
    orbLow := nz(orbLow[1], orbLow)

orbReady = not na(orbHigh) and not na(orbLow)

// Plots (editable in indicator Style settings)
plot(shouldShow and orbReady ? orbHigh : na, title="ORB High", color=color.green, linewidth=2, style=plot.style_line)
plot(shouldShow and orbReady ? orbLow : na, title="ORB Low", color=color.red, linewidth=2, style=plot.style_line)
